<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HappyBlack | CEO Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Georgia&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --dark-bg: #0a0a0a; --card-bg: #0b0b0b; }
        body { margin: 0; background: var(--dark-bg); color: #f5f5f5; font-family: Georgia, serif; }
        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        .login-overlay { position: fixed; inset: 0; background: var(--dark-bg); z-index: 5000; display: flex; align-items: center; justify-content: center; }
        .login-card { background: var(--card-bg); padding: 40px; border-radius: 20px; box-shadow: 0 6px 20px rgba(0,0,0,0.45); text-align: center; width: 90%; max-width: 400px; border: 1px solid #1b1b1c; }
        .logo-ceo { width: 96px; margin-bottom: 16px; }
        input { width: 100%; padding: 15px; margin: 15px 0; background: #151515; border: 1px solid #333; border-radius: 10px; color: white; text-align: center; box-sizing: border-box; }
        .btn-gold { background: var(--gold); color: black; border: none; padding: 15px 30px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; text-transform: uppercase; transition: 0.3s; }
        .btn-gold:hover { opacity: 0.8; }
        .stats-banner { background: #0f0f10; border: 1px solid #1b1b1c; padding: 25px; border-radius: 16px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .order-card { background: #0f0f10; border: 1px solid #1b1b1c; border-radius: 16px; padding: 20px; margin-bottom: 15px; }
        .status-pill { font-size: 10px; padding: 4px 12px; border-radius: 50px; background: #1b1b1c; color: var(--gold); border: 1px solid var(--gold); }
        .hidden { display: none !important; }
        .divider { width: 72px; height: 2px; background: var(--gold); margin: 20px auto; }
    </style>
</head>
<body>

    <div id="login-screen" class="login-overlay">
        <div class="login-card">
            <img src="Happylogo.png" class="logo-ceo">
            <div style="color: var(--gold); letter-spacing: 2px; font-size: 12px; margin-bottom: 10px;">CEO ACCESS</div>
            <h2 style="font-size: 20px; margin-bottom: 20px;">VerificaciÃ³n</h2>
            <input type="text" id="admin-chatid" placeholder="Chat ID Personal">
            <button onclick="solicitarAcceso()" class="btn-gold">Solicitar Token</button>
            <div id="otp-section" class="hidden">
                <input type="text" id="admin-otp" placeholder="Token de 4 dÃ­gitos">
                <button onclick="verificarAcceso()" class="btn-gold" style="background: #eee;">Entrar</button>
            </div>
        </div>
    </div>

    <div id="admin-content" class="container hidden">
        <header style="text-align: center; margin-bottom: 40px;">
            <img src="Happylogo.png" class="logo-ceo">
            <h1 style="font-size: 30px;">HappyBlack CEO Panel</h1>
            <div class="divider"></div>
        </header>

        <div class="stats-banner">
            <div>
                <div style="color: var(--gold); font-size: 12px;">VENTAS ENTREGADAS</div>
                <div id="total-monto" style="font-size: 32px; font-weight: 700;">$0</div>
            </div>
            <div id="fecha-actual" style="font-size: 14px; color: #888;"></div>
        </div>

        <div id="grid-pedidos"></div>
    </div>

    <script>
        let otpGenerado = "";
        const API_BASE = "https://happy-corner.vercel.app/api";

        async function solicitarAcceso() {
            const chatId = document.getElementById('admin-chatid').value;
            if(!chatId) return alert("Ingrese su Chat ID");
            
            otpGenerado = Math.floor(1000 + Math.random() * 9000).toString();

            try {
                const resp = await fetch(`${API_BASE}/sendotp`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ chatId, otp: otpGenerado })
                });

                if(resp.ok) {
                    document.getElementById('otp-section').classList.remove('hidden');
                    alert("ðŸ” Token enviado a Telegram");
                } else {
                    alert("ID no autorizado");
                }
            } catch (err) {
                alert("Error de conexiÃ³n con la API");
            }
        }

        function verificarAcceso() {
            const val = document.getElementById('admin-otp').value;
            if(val === otpGenerado && otpGenerado !== "") {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-content').classList.remove('hidden');
                document.getElementById('fecha-actual').innerText = new Date().toLocaleDateString();
                cargarPedidos();
            } else {
                alert("Token incorrecto");
            }
        }

        async function cargarPedidos() {
            try {
                const resp = await fetch(`${API_BASE}/getOrders`);
                const data = await resp.json();
                const grid = document.getElementById('grid-pedidos');
                grid.innerHTML = '';
                let total = 0;

                data.forEach(p => {
                    if(p.estado === 'Entregado') {
                        total += parseInt(p.total.replace(/[^0-9]/g, '')) || 0;
                    }
                    grid.innerHTML += `
                        <div class="order-card">
                            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                                <span style="color:var(--gold); font-size:12px;">ID #${p.id}</span>
                                <span class="status-pill">${p.estado}</span>
                            </div>
                            <div style="font-weight:700; font-size:18px;">${p.nombre}</div>
                            <div style="color:var(--gold); margin-top:10px;">${p.total}</div>
                            <div style="font-size:12px; color:#666; margin-top:5px;">ðŸ“± ${p.whatsapp} | ðŸ’³ ${p.metodo_pago}</div>
                        </div>`;
                });
                document.getElementById('total-monto').innerText = `$${total.toLocaleString()}`;
            } catch (e) { console.error(e); }
        }
    </script>
</body>
</html>
